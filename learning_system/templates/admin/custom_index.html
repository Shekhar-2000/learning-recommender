{% extends "admin/base_site.html" %}

{% block content %}


  <div class="dashboard">
    <h1>Site Administration</h1>
    <p>Welcome to the admin dashboard. Here you can oversee all users, courses, quizzes, performances, and manage the database.</p>

    <div style="display: flex; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap;">
      <div style="background: #f8fafd; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 1.2rem; min-width: 180px; flex: 1;">
        <h3>Users</h3>
        <p><strong>{% with total=app_list.0.models.0.count %}{{ total|default:"View" }}{% endwith %}</strong> total</p>
        <a class="button" href="{% url 'admin:users_table' %}">View All Users</a>
      </div>
      <div style="background: #f8fafd; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 1.2rem; min-width: 180px; flex: 1;">
        <h3>Courses</h3>
        <p><strong>{% with total=app_list.0.models.1.count %}{{ total|default:"View" }}{% endwith %}</strong> total</p>
        <a class="button" href="{% url 'admin:learning_system_course_changelist' %}">View All Courses</a>
        <a class="button" style="margin-top:0.5rem;background:#007bff;color:#fff;" href="{% url 'admin:learning_system_course_add' %}">Add New Course</a>
      </div>
      <div style="background: #f8fafd; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 1.2rem; min-width: 180px; flex: 1;">
        <h3>Quizzes</h3>
        <p><strong>{% with total=app_list.0.models.2.count %}{{ total|default:"View" }}{% endwith %}</strong> total</p>
        <a class="button" href="{% url 'admin:learning_system_quiz_changelist' %}">View All Quizzes</a>
      </div>
      <div style="background: #f8fafd; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 1.2rem; min-width: 180px; flex: 1;">
        <h3>Performances</h3>
        <p><strong>{% with total=app_list.0.models.3.count %}{{ total|default:"View" }}{% endwith %}</strong> total</p>
        <a class="button" href="{% url 'admin:learning_system_quizperformance_changelist' %}">View All Performances</a>
      </div>
      <div style="background: #f8fafd; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 1.2rem; min-width: 180px; flex: 1;">
        <h3>Database</h3>
        <p>Access and manage all data models.</p>
        <a class="button" href="/admin/">Full Database Access</a>
      </div>
    </div>

    <hr />
    <h2>Quick Links</h2>
    <ul>
      <li><a class="button" href="{% url 'admin:users_table' %}">View Users Table</a></li>
      <li><a href="{% url 'admin:learning_system_course_changelist' %}">Manage Courses</a></li>
      <li><a href="{% url 'admin:learning_system_course_add' %}">Add New Course</a></li>
      <li><a href="{% url 'admin:learning_system_quiz_changelist' %}">Manage Quizzes</a></li>
      <li><a href="{% url 'admin:learning_system_quizperformance_changelist' %}">Quiz Performances</a></li>
      <li><a href="/admin/">Full Database Access</a></li>
    </ul>

    <hr />
    {# Render the default app list so admins still see normal admin links #}
    {% if app_list %}
      <div class="app-list">
        {% for app in app_list %}
          <div class="app">
            <h2>{{ app.name }}</h2>
            <ul>
              {% for model in app.models %}
                <li><a href="{{ model.admin_url }}">{{ model.name }}</a></li>
              {% endfor %}
            </ul>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

{% endblock %}


<!-- Chatbot Button and Widget (always visible) -->
<style>
#faq-chatbot-toggle {
  position: fixed; bottom: 2.5rem; right: 2.5rem; z-index: 1100;
  background: linear-gradient(90deg,#007bff,#00c6ff); color: #fff; border: none;
  border-radius: 50%; width: 56px; height: 56px; box-shadow: 0 2px 8px #0002;
  font-size: 2em; display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: background 0.2s;
}
#faq-chatbot-toggle:hover { background: linear-gradient(90deg,#0056b3,#00aaff); }
#faq-chatbot {
  position: fixed; bottom: 2rem; right: 2rem; width: 340px; max-width: 95vw;
  background: #fff; border-radius: 16px; box-shadow: 0 4px 24px #0002; border: none; z-index: 1000;
  font-family: 'Segoe UI', Arial, sans-serif;
}
#faq-chatbot-header {
  background: linear-gradient(90deg,#007bff,#00c6ff); color: #fff;
  padding: 0.7rem 1.2rem; border-top-left-radius: 16px; border-top-right-radius: 16px;
  font-weight: bold; font-size: 1.1em; letter-spacing: 0.5px;
  box-shadow: 0 2px 8px #0001;
}
#faq-chatbot-messages {
  height: 200px; overflow-y: auto; padding: 0.7rem; background: #f8fafd;
  font-size: 1em; border-bottom: 1px solid #eee;
}
.faq-msg {
  max-width: 80%; margin: 0.3em 0; padding: 0.5em 0.9em; border-radius: 12px;
  display: inline-block; word-break: break-word;
}
.faq-msg.user {
  background: #e3f0ff; color: #007bff; text-align: right; float: right;
  border-bottom-right-radius: 2px;
}
.faq-msg.bot {
  background: #fff; color: #222; text-align: left; float: left;
  border-bottom-left-radius: 2px;
  border: 1px solid #e0e0e0;
}
#faq-chatbot-form {
  display: flex; gap: 0.5rem; padding: 0.7rem; background: #f5f5f5;
  border-bottom-left-radius: 16px; border-bottom-right-radius: 16px;
  border-top: 1px solid #eee;
}
#faq-chatbot-input {
  flex: 1; padding: 0.5rem 0.7rem; border-radius: 8px; border: 1px solid #ccc;
  font-size: 1em; background: #f8fafd;
}
#faq-chatbot-form button {
  padding: 0.5rem 1.2rem; border-radius: 8px; border: none; background: #007bff; color: #fff;
  font-weight: bold; cursor: pointer; transition: background 0.2s;
}
#faq-chatbot-form button:hover {
  background: #0056b3;
}
</style>
<button id="faq-chatbot-toggle" title="Chatbot" aria-label="Toggle FAQ Chatbot">ðŸ’¬</button>
<div id="faq-chatbot" style="display:none;">
  <div id="faq-chatbot-header">FAQ Chatbot</div>
  <div id="faq-chatbot-messages"></div>
  <form id="faq-chatbot-form">
    <input type="text" id="faq-chatbot-input" placeholder="Ask a question..." autocomplete="off" />
    <button type="submit">Send</button>
  </form>
</div>
<script>
document.getElementById('faq-chatbot-toggle').onclick = function() {
  var bot = document.getElementById('faq-chatbot');
  bot.style.display = bot.style.display === 'none' ? 'block' : 'none';
};
var form = document.getElementById('faq-chatbot-form');
var input = document.getElementById('faq-chatbot-input');
var messages = document.getElementById('faq-chatbot-messages');
function addMsg(text, sender) {
  var div = document.createElement('div');
  div.textContent = text;
  div.className = 'faq-msg ' + sender;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
  setTimeout(function(){div.style.opacity=1;},10);
  var clear = document.createElement('div'); clear.style.clear='both'; messages.appendChild(clear);
}
form.onsubmit = function(e){
  e.preventDefault();
  var q = input.value.trim();
  if(!q) return;
  addMsg(q, 'user');
  input.value = '';
  // Get CSRF token from form
  var csrfToken = document.querySelector('#faq-chatbot-form input[name="csrfmiddlewaretoken"]').value;
  fetch('/admin/faq-chatbot/', {
    method: 'POST',
    headers: {
      'X-Requested-With':'XMLHttpRequest',
      'Content-Type':'application/x-www-form-urlencoded',
      'X-CSRFToken': csrfToken
    },
    body: 'message=' + encodeURIComponent(q)
  }).then(r => r.json()).then(data => {
    addMsg(data.answer || 'No answer.', 'bot');
  }).catch(()=>{
    addMsg('Error contacting FAQ bot.', 'bot');
  });
};
</script>
